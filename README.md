# CDI Project - текстовый помошник для построения стратегия развития ЦДИ до 2030 года

#### Описание
Этот проект предназначен для помощи в разработки стратегии развития Центра Дигитализации и Инноваций (ЦДИ) до 2030 года. В рамках проекта происходит сбор, обработка и анализ нормативных документов, которые будут использованы для формирования рекомендаций и планов развития.

### Особенности проекта
- Автоматизация обработки нормативной документации
- Конвертация PDF документов в структурированный формат JSON
- Использование Elasticsearch для индексации и поиска по тексту документов
- Поддержка запросов на естественном языке для удобного доступа к информации
- WEB-API для взаимодействия с пользователем

### Текущие результаты
Проект находится в стадии разработки. На данном этапе:
- Обеспечена начальная обработка и конвертация документов
- Elasticsearch установлен на сервер и настроен для удалённого использования по домену (задача непростая ввиду ухода Elastic с Российского рынка, помогли зеркала Яндекса для пакетных менеджеров линукса)
- Добавлен препроцессинг текстов в виде исправления орфаграфии и лематизации
- Настроены базовые индексационные процессы для Elasticsearch
- Начата работа над интеграцией поиска с использованием естественного языка
- Создан веб интерфейс (API) для взаимодействия с пользователем или веб-приложением

### Приоритетные цели
- Добавить удаление стоп-слов в препроцессинг

### Дополнительные цели
- Оптимизировать добавление документов в индекс
- Оптимизировать и улучшить качество поиска по документам


# Документация к API для обработки PDF
Этот API предоставляет конечные точки для загрузки, обработки и поиска PDF документов. Он обрабатывает загруженные PDF, сохраняет их содержимое в Elasticsearch и позволяет пользователям искать по ним с использованием естественного языка.

## Конечные точки
### 1. Загрузка PDF
**POST /upload**

Эта конечная точка позволяет загружать PDF файл для обработки. Вы можете либо загрузить файл напрямую, либо предоставить URL на PDF файл.

#### Тело запроса (Form Data)
- **file**: PDF файл для загрузки (необязательно при наличии file_url).
- **file_url**: URL PDF файла для загрузки (необязательно при наличии file).

#### Ответ
- **200 OK**:

  Если файл успешно загружен и обработка началась.
  ```json
  {
    "message": "File uploaded successfully, processing started",
    "task_id": 1
  }
  ```
- **400 Bad Request**: 

  Если нет сразу обоих полей file и file_url
  ```json
  {
    "error": "No file or file URL provided"
  }
  ```
  Если есть поле file, но самого файла нет
  ```json
  {
    "error": "No selected file"
  }
  ```
  Если выбран файл не в формате .pdf
  ```json
  {
    "error": "Invalid file format, only PDF allowed"
  }
  ```

### 2. Получение прогресса обработки
**GET /progress/<task_id>**

Эта конечная точка позволяет проверить прогресс выполнения конкретной задачи. Возвращает текущий прогресс разбора PDF и индексации документа в Elasticsearch.

#### Параметры запроса
- **task_id**: Уникальный идентификатор задачи, для которой нужно получить прогресс.

#### Ответ
- **200 OK**: Если задача существует и обрабатывается или уже закончена.
  ```json
  {
    "pdf_parsing_progress": 50,
    "adding_doc_to_elastic_progress": 25
  }
  ```
- **404 Not Found**: Если задача не существует или не началась.
  ```json
  {
    "error": "Task not found or not started yet"
  }
  ```

### 3. Поиск по запросу
**POST /search**

Эта конечная точка позволяет искать документы, сохраненные в Elasticsearch, по запросу пользователя.

#### Запрос
- **query**: Поисковый запрос.

#### Тело запроса (JSON)
```json
{
  "query": "поисковый запрос"
}
```

#### Ответ
- **200 OK**: Если запрос успешно обработан.
  ```json
  {
    "results": [
      {
            "bbox": [
                70.94400024414062,
                570.1958618164062,
                527.9199829101562,
                678.9252319335938
            ],
            "document_name": "файл.pdf",
            "page_number": 1,
            "paragraph_number": 10,
            "score": 2.5717645,
            "text": "текс параграфа"
        },
      ...
    ]
  }
  ```
- **400 Bad Request**: Если запрос не был предоставлен.
  ```json
  {
    "error": "No query provided"
  }
  ```

## Хранение файлов

Загруженные PDF файлы сохраняются в папке `pdfs`. Лимит размера файла — 100 МБ.

## Фоновые процессы

Разбор PDF и индексация в Elasticsearch выполняются в фоновом режиме с использованием потоков. Информация о прогрессе записывается во временные JSON файлы, которые можно проверять через конечную точку `/progress/<task_id>`.
